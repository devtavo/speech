
<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="Last-Modified" content="-1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <!-- Latest compiled and minified JavaScript --> 
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>        <script src='https://code.responsivevoice.org/responsivevoice.js'></script>
        <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/p5.js"></script>
        <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/addons/p5.dom.js"></script>
        <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/addons/p5.sound.js"></script>
        <script src="js/p5speech.js" type="text/javascript"></script>
        <title>Instant Voice Traslator</title>
    </head>
    <style>
        .fondo{

            margin-top:300px;
            margin-left: 300px;
            padding: 5px 10px;
            background-color: #d71a1f;

            position: absolute;
            opacity: 0.3;

        }
        .iconos{
            width: 350px;
            margin-left: 100px;
            margin-top: 200px;
            position: absolute;
            font-size: 25px;
            font-weight: bold;
            border-radius: 50px;


        }
        @media (max-width: 320px) {
            .iconos{
                width: 150px;
                margin-left: 10px;
                margin-top: 200px;
                position: absolute;
                font-size: 7px;
                font-weight: bold;
                border-radius: 50px;


            } 
        }


        @media (min-width: 768px) { 
            .iconos{
                width: 350px;
                margin-left: auto;
                margin-top: 200px;
                position: absolute;
                font-size: 25px;
                font-weight: bold;
                border-radius: 50px;


            }

        }


        @media (min-width: 992px) {  
            .iconos{
                width: 350px;
                margin-left: auto;
                margin-top: 200px;
                position: absolute;
                font-size: 25px;
                font-weight: bold;
                border-radius: 50px;


            }
        }


        @media (min-width: 1200px) {
            .iconos{
                width: 350px;
                margin-left: 600px;
                margin-top: 200px;
                position: absolute;
                font-size: 25px;
                font-weight: bold;
                border-radius: 50px;


            }
        }
        .modal-dialog {
            margin: 20px;
            width: 100%; 
        }
        .modal-content{
            width: 1200px;

            margin-top: 50px;
        }
        .boton{
            text-decoration:none;
            /*font-weight: 600;
            font-size: 20px;*/
            color:#ffffff;
            /*padding-top:15px;
            padding-bottom:15px;
            padding-left:40px;
            padding-right:40px;*/
            background-color: transparent;
            border-width: 1px;
            border-style: solid;
            border-color: #ffffff; border-radius:5px;
            position: absolute;


            margin-left: 1450px;

        }
        .boton:hover{
            background-color: white;
            color: black;

        }
        .ratio:hover{

            transform: scale(1.3);
        }

    </style>
    <body onload="setcookie()"  style="background-color: #d71a1f">

        <script type="text/javascript">
            function googleTranslateElementInit() {
                new google.translate.TranslateElement({
                    includedLanguages: 'en,es', layout: google.translate.TranslateElement.FloatPosition.TOP_RIGHT,
                    defaultLanguage: idiomatras}, 'google_translate_element');
            }
        </script>
        <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
        <!-- Modal -->
        <div class="modal fade" id="myModalspanish" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
                        <h6 class="modal-title" id="myModalLabel"></h6>
                        <label for="genero" class="ratio" >
                            <img src="images/icono-hombre-1.png" onclick="genero3()">
                        </label> 

                        <input type="radio" id="genero" name="genero" value="US English Male" style="display: none"></input>

                        <label for="genero" class="ratio" >
                            <img src="images/icono-mujer-1.png" onclick="genero2()"  >
                        </label> 

                        <input type="radio" id="genero" name="genero" value="US English Female" style="display: none"></input>
                        <button id='empezar_grabar' data-toggle="tooltip" data-placement="top" title="Empieza a reproducir y grabar a la vez" translate="no" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-play" ></span> Empezar a grabar</button>
                    </div>
                    <div class="modal-body">
                        <div class="panel panel-default">
                            <div class="panel-body" >

                                <textarea placeholder="Aquí se convertirá el audio en texto" id='textArea' style="width: 1200px;height:700px;border-radius: 20px;border-width: 5px;padding-left: 10px"></textarea>                             

                                <div id="textArea2"  style="color: black; font-size: 1px"></div>
                                <div id="otro" style="color: black; font-size: 1px"></div>
                            </div></div>    


                    </div>

                </div>
            </div>
        </div>


        <div class="modal fade" id="myModalspanish2" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
                        <h6 class="modal-title" id="myModalLabel"></h6>
                        <button id='empezar_grabar2' data-toggle="tooltip" data-placement="top" title="Empieza a reproducir y grabar a la vez" translate="no" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-play" ></span> Empezar a grabar</button>
                    </div>
                    <div class="modal-body">
                        <div class="panel panel-default">
                            <div class="panel-body" >

                                <textarea placeholder="Aquí se convertirá el audio en texto" id='textArea2' style="width: 1200px;height:700px;border-radius: 20px;border-width: 5px;padding-left: 10px"></textarea>                             

                                <div id="textArea22"  style="color: black; font-size: 20px"></div>
                                <div id="otro2" style="color: black; font-size: 20px"></div>
                            </div></div>    


                    </div>

                </div>
            </div>
        </div>
        <div class="fondo" >
            <img src="images/crosscurricular-en-blanco-png.png" width=100% height="100%">        
        </div>

        <div class="row">
            <div>
                <div class="col">
                    <button data-toggle="modal" data-target="#myModalspanish"  id="es" name="ass" class="btn btn-outline-light btn-block iconos"  onclick="idiomaes()" value="es">ESPAÑOL</button>
                </div>

                <div>
                    <button data-toggle="modal" data-target="#myModalspanish" id="en" name="ass" class="btn btn-outline-light btn-block iconos" onclick="idiomaen()"  value="en" style="margin-top: 300px;">INGLES</button>
                </div>
                <div>
                    <button data-toggle="modal" data-target="#myModalspanish" id="en2" name="ass" class="btn btn-outline-light btn-block iconos" onclick="idiomaes()" value="en2" style="margin-top: 400px;">INGLES - ESPAÑOL</button>
                </div>
                <div>
                    <button data-toggle="modal" on data-target="#myModalspanish" id="en3" name="ass" class="btn btn-outline-light btn-block iconos" onclick="idiomaen()" value="en2" style="margin-top: 500px;">ESPAÑOL - INGLES</button>
                </div>
            </div>
        </div>

        <div>
            <a href="index.html" class="boton">Regresar a menu</a>
        </div>


        <script type="text/javascript">
            jQuery.noConflict();
            var idioma = "";
            var idiomatras = "es";
            var name = "myModalenglish";
            var genero = "";
            function genero3() {
                var key=localStorage.getItem("key");
                if(key=="español"){
                  idioma="Spanish Latin American Male";
                  console.log(idioma);
                }
                if(key=="ingles"){
                    idioma="US English Male";
                    console.log(idioma);
                }
                
            }
            function genero2() {
                var key=localStorage.getItem("key");
                if(key=="español"){
                  idioma="Spanish Latin American Female";
                  console.log(idioma);
                }
                if(key=="ingles"){
                    idioma="US English Female";
                    console.log(idioma);
                }
            }

            $(document).ready(function () {
                estado1 = localStorage.getItem("estado");

                if (estado1 == 1) {
                    $("#myModalspanish").modal('show');
                    localStorage.setItem("estado", "0");
                    //idioma = localStorage.getItem("idioma");

                }


            });

            function setcookie() {
                document.cookie = "googtrans=/auto/es; expires=N/A;path=/";
            }
            $(function () {
                $('[data-toggle="tooltip"]').tooltip();
            });

            function idiomaes() {
               // localStorage.setItem("idioma", "Spanish Latin American Female");
                idiomatras = "es";
                document.cookie = "googtrans=/auto/" + idiomatras + "; expires=N/A;path=/";
                estado = localStorage.getItem("estado");
                localStorage.setItem("key","español");    
                if (estado == "0") {
                    location.reload();
                    localStorage.setItem("estado", "1");
                }
            }

            function idiomaen() {

                //localStorage.setItem("idioma", "US English Female");
                idiomatras = "en";
                document.cookie = "googtrans=/auto/" + idiomatras + "; expires=N/A;path=/";
                estado = localStorage.getItem("estado");
                localStorage.setItem("key","ingles");    
                if (estado == "0") {

                    location.reload();
                    localStorage.setItem("estado", "1");
                }
            }


            var statev = 0;
            var traducido2 = "";
            var traducido = "";
            var speech = new webkitSpeechRecognition();
            var speech2 = new webkitSpeechRecognition();
            speech2.continuous = true;
            speech2.interimResults = true;
            speech2.lang = "es-Es";

            speech.continuous = true;
            speech.interimResults = true;
            speech.lang = "es-Es";
            speech.maxAlternatives = 1;


            var ttt = "";
            var text2 = '';
            var textArea = '';
            var ttt2 = "";
            var text22 = '';
            var textArea2 = '';
            //            speech.onresult = function (event)
            //            {
            //                var textArea = document.getElementById("textArea");
            //                textArea.innerHTML += event.results[event.results.length - 1][0].transcript;
            //                document.getElementById("textArea2").innerHTML = textArea.textContent;
            //            };
            var interim_transcript = '';

            text2 = document.getElementById("textArea2");
            textArea = document.getElementById("textArea");
            class Queue {
                constructor() {
                    this.queue = [];
                }

                enqueue(element) {
                    this.queue.push(element);
                    return this.queue;
                }

                dequeue() {
                    return this.queue.shift();
                }

                peek() {
                    return this.queue[0];
                }

                size() {
                    return this.queue.length;
                }

                isEmpty() {
                    return this.queue.length === 0;
                }

                print() {
                    return this.queue;
                }
            }

            const queue = new Queue();
            const  queue2 = new Queue();
            var tra = "";
            var test = 0;
            speech.onresult = function (event) {


                var len = event.results.length - 1;

                if (event.results[len].isFinal) {
                    var a = "";
                    a = event.results[len][0].transcript;
                    queue.enqueue(a);
                    text2.innerHTML = queue.peek();
                    queue.dequeue();

                    test = 1;
                    if (test == 1) {
                        test = 0;
                        window.setTimeout('obtener()', 900);

                    }
                }


            };



            function obtener() {

                traducido = document.getElementById("textArea2").textContent;
                queue2.enqueue(traducido);
                console.log(traducido);
                tra = queue2.peek();
                queue2.dequeue();
                textArea.innerHTML += tra;
                responsiveVoice.speak(tra, idioma, {pitch: 1}, {rate: 0});

            }


            speech2.onresult = function (event2) {
                var interim_transcript2 = '';

                for (var i = event2.resultIndex; i < event2.results.length; ++i) {
                    if (event2.results[i].isFinal) {
                        final_transcript2 += event2.results[i][0].transcript;
                    } else {
                        interim_transcript2 += event2.results[i][0].transcript;
                    }

                    textArea2 = document.getElementById("textArea2");
                    textArea2.innerHTML = " " + final_transcript2;
                    text22 = document.getElementById("textArea22");
                    text22.innerHTML = interim_transcript2;

                    console.log(final_transcript2);
                    //                       console.log(interim_transcript);
                    text22 = document.getElementById("textArea2");
                    text22.innerHTML = interim_transcript2;
                    //                       console.log("resultado"+event.results[event.results.length-1][0].transcript);
                }


            };

            //////////////////////p5.js
            //             var myRec = new p5.SpeechRec();
            //            function setup() {
            //                
            //                myRec.continuous = true;
            //                myRec.interimResults = true;
            //                myRec.defaultLanguage = "en-US";
            //                myRec.onResult = showResult;
            //                var ttt = "";
            //                var textArea = "";
            //                var tradd = "";
            //                var tre = "";
            //                function showResult()
            //                {
            //                    if (myRec.resultValue === true) {
            //                        if (myRec.resultConfidence >= 0.89 && myRec.resultConfidence <= 0.91) {
            //
            //                            ttt = ttt + myRec.resultString;
            //                            textArea = document.getElementById("textArea");
            //                            textArea.innerHTML = " " + ttt;
            //                            document.getElementById("textArea2").innerHTML = myRec.resultString;
            //                            myRec.resultString = "";
            //                            window.setTimeout(obtener, 1000);
            //                        }
            //                    }
            //                }
            //                function obtener() {
            //
            //                    traducido = document.getElementById("textArea2").textContent;
            //                    tre = tre + traducido;
            //
            //                    //                    tradd = document.getElementById("traduc");
            //                    // tradd.innerHTML = tre + " ";
            //
            //                    responsiveVoice.speak(traducido, idioma, {pitch: 0}, {rate: 0});
            //                    document.getElementById("textArea2").innerHTML = myRec.resultString;
            //                }
            ////                recorder = new p5.SoundRecorder();
            //                // connect the mic to the recorder
            ////                recorder.setInput(mic);
            ////                soundFile = new p5.SoundFile();
            //            }

            //            var genero = "";
            document.querySelector('#empezar_grabar').addEventListener('click', function () {
                final_transcript = "";
                speech.start();
            });

            //            document.querySelector('#textArea').addEventListener('onchange', function () {
            //                var ooo = document.getElementById("textArea2").innerHTML = speechresult;
            //            });



        </script>


    </body>
</html>
